<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Car Frost Predictor — Nottingham</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
  :root {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    line-height: 1.45;
  }
  body {
    max-width: 820px;
    margin: 0 auto;
    background: #f8fafc;
    color: #0f172a;
    overflow-x: hidden;
  }

  /* ---------- SLIDE ANIMATIONS ---------- */

  #slide {
    position: relative;
    animation-duration: 0.35s;
    animation-timing-function: ease-out;
  }
  .slide-in-right { animation-name: slideInRight; }
  .slide-in-left  { animation-name: slideInLeft; }

  @keyframes slideInRight {
    0% { opacity: 0; transform: translateX(40px); }
    100% { opacity: 1; transform: translateX(0); }
  }
  @keyframes slideInLeft {
    0% { opacity: 0; transform: translateX(-40px); }
    100% { opacity: 1; transform: translateX(0); }
  }

  /* ---------- PAGE UI ---------- */
  .card {
    background: white;
    padding: 20px;
    margin: 32px 20px 100px 20px;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  }
  h1 { font-size: 22px; margin: 0 0 12px; }

  #badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 8px;
    font-weight: 600;
    margin-bottom: 10px;
  }
  .badge-good { background: #ecfdf5; color: #0f5132; }
  .badge-bad  { background: #ffeef0; color: #c0262e; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
    font-size: 14px;
  }
  th, td {
    padding: 6px 8px;
    text-align: left;
    border-bottom: 1px solid #e2e8f0;
  }

  footer {
    margin-top: 16px;
    font-size: 13px;
    color: #64748b;
  }

  #addHome {
    display: none;
    margin: 10px 0 14px 0;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 14px;
    background: #0f172a;
    color: #fff;
    border: none;
    cursor: pointer;
  }

  /* ---- BOTTOM MENU ---- */
  nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #ffffff;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    font-size: 15px;
  }
  nav a {
    text-decoration: none;
    color: #0f172a;
    font-weight: 600;
  }
  nav a.active { color: #1d4ed8; }

  @media (prefers-color-scheme: dark) {
    body{background:#0b1220;color:#e6eef8;}
    .card{background:#071226;}
    nav{background:#0b1220;border-top-color:#1e2633;}
    nav a{color:#e6eef8;}
    nav a.active{color:#60a5fa;}
  }
</style>
</head>

<body>
<div id="slide" class="slide-in-right">

  <div class="card">
    <h1>Will your car frost up tomorrow morning?</h1>

    <div id="badge" class="badge-good">Checking...</div>
    <div id="advice" style="font-weight:600;margin-bottom:8px;"></div>

    <button id="addHome">Add to Home Screen</button>

    <div id="explain" style="margin:6px 0 10px 0;">Fetching forecast…</div>
    <div id="meta"></div>

    <table id="hourly" hidden>
      <thead>
        <tr>
          <th>Time</th>
          <th>Temp °C</th>
          <th>Dew °C</th>
          <th>RH %</th>
          <th>Wind</th>
          <th>Cloud %</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <footer> :) </footer>
  </div>

</div>

<!-- Bottom Navigation -->
<nav>
  <a href="test.html" class="active" data-direction="right">Frost</a>
  <a href="index.html" data-direction="left">Is simon off?</a>
</nav>

<!-- Slide script -->
<script>
document.querySelectorAll("nav a").forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    const direction = link.dataset.direction;
    const slide = document.getElementById("slide");

    slide.className = direction === "left" ? "slide-in-left" : "slide-in-right";

    setTimeout(() => {
      window.location.href = link.href;
    }, 200);
  });
});
</script>

<!-- PWA and Frost Logic identical to before -->
<script>
// Add to Home Screen
let deferredPrompt;
const addHomeBtn=document.getElementById('addHome');
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault(); deferredPrompt=e;
  addHomeBtn.style.display='inline-block';
});
addHomeBtn.addEventListener('click',async()=>{
  addHomeBtn.style.display='none';
  if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; }
});
</script>

<script>
// Service worker
if("serviceWorker" in navigator){
  window.addEventListener("load",()=>navigator.serviceWorker.register("sw.js"));
}
</script>

<script>
// Main frost logic (unchanged)
(async function(){
  const lat=52.95,lon=-1.15,tz="Europe/London";
  const badge=document.getElementById("badge");
  const advice=document.getElementById("advice");
  const explain=document.getElementById("explain");
  const meta=document.getElementById("meta");
  const hourlyTable=document.getElementById("hourly");
  const tbody=hourlyTable.querySelector("tbody");

  function setBadge(text,good){
    badge.textContent=text;
    badge.className=good?"badge-good":"badge-bad";
  }

  try{
    explain.textContent="Preparing dates...";
    const now=new Date();
    const fmt=new Intl.DateTimeFormat("en-GB",{timeZone:tz,year:"numeric",
      month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",
      second:"2-digit",hour12:false});
    const parts=Object.fromEntries(fmt.formatToParts(now).map(p=>[p.type,p.value]));
    let y=+parts.year,m=+parts.month,d=+parts.day,hour=+parts.hour;

    if(hour>=6){
      const dt=new Date(Date.UTC(y,m-1,d));
      dt.setUTCDate(dt.getUTCDate()+1);
      y=dt.getUTCFullYear(); m=dt.getUTCMonth()+1; d=dt.getUTCDate();
    }

    const pad=n=>String(n).padStart(2,"0");
    const dateStr=`${y}-${pad(m)}-${pad(d)}`;
    explain.textContent="Fetching forecast…";

    const resp=await fetch(
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`+
      `&hourly=temperature_2m,dewpoint_2m,relative_humidity_2m,cloud_cover,wind_speed_10m`+
      `&timezone=${encodeURIComponent(tz)}&start_date=${dateStr}&end_date=${dateStr}`
    );
    const data=await resp.json();

    const times=data.hourly.time, temps=data.hourly.temperature_2m;
    const dews=data.hourly.dewpoint_2m, hums=data.hourly.relative_humidity_2m;
    const winds=data.hourly.wind_speed_10m, clouds=data.hourly.cloud_cover;

    const overnight=[];
    for(let i=0;i<times.length;i++){
      if(times[i].startsWith(dateStr+"T")){
        const h=+times[i].slice(11,13);
        if(h>=0 && h<=5){
          overnight.push({
            time:times[i], temp:temps[i], dew:dews[i],
            rh:hums[i], wind:winds[i], cloud:clouds[i]
          });
        }
      }
    }

    tbody.innerHTML="";
    hourlyTable.hidden=false;

    let coldest=null;
    overnight.forEach(o=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${o.time.replace("T"," ")}</td>
        <td>${o.temp.toFixed(1)}</td>
        <td>${o.dew.toFixed(1)}</td>
        <td>${o.rh}</td>
        <td>${o.wind.toFixed(1)}</td>
        <td>${o.cloud}</td>`;
      tbody.appendChild(tr);
      if(!coldest || o.temp<coldest.temp) coldest=o;
    });

    const temp=coldest.temp, dew=coldest.dew;
    const dewGap=temp-dew, wind=coldest.wind, cloud=coldest.cloud;

    const frostRisk =
      temp <= 2 &&
      dewGap <= 1 &&
      wind <= 3 &&
      cloud <= 40;

    if(frostRisk){
      setBadge("Frost Likely", false);
      advice.textContent="Put the frost cover on. Conditions ideal for frost.";
    } else {
      setBadge("No Frost Expected", true);
      advice.textContent="Frost unlikely based on temperature, wind, and cloud.";
    }

    meta.textContent=`Coldest hour: ${coldest.time.replace("T"," ")}`;
    explain.textContent = `Checked 00:00–05:59 for ${dateStr}`;

  } catch(err){
    setBadge("Error",false);
    explain.textContent=err.message;
  }
})();
</script>

</body>
</html>
