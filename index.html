<!doctype html>
<html lang="en">
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
  
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Is Simon off?</title>

  <button id="addHome">Install as App</button>

<style>
  body {
    max-width: 820px;
    margin: 0 auto;
    background: #f8fafc;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    overflow-x: hidden;
  }

  #slide {
    position: relative;
    padding: 32px 20px 100px 20px;
    animation-duration: 0.35s;
    animation-timing-function: ease-out;
  }
  .slide-in-right { animation-name: slideInRight; }
  .slide-in-left  { animation-name: slideInLeft; }

  @keyframes slideInRight { 0%{opacity:0;transform:translateX(40px);}100%{opacity:1;transform:translateX(0);} }
  @keyframes slideInLeft  { 0%{opacity:0;transform:translateX(-40px);}100%{opacity:1;transform:translateX(0);} }

  .card {
    background: white;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    margin-bottom: 20px;
  }

  .status-good { color:#0f5132; background:#ecfdf5; padding:8px 12px; border-radius:8px; font-weight:600; display:inline-block; }
  .status-bad  { color:#c0262e; background:#ffeef0; padding:8px 12px; border-radius:8px; font-weight:600; display:inline-block; }

  .forecast-item {
    padding:8px 12px;
    border-radius:8px;
    margin-bottom:6px;
    font-size:15px;
  }
  .work { background:#ecfdf5; color:#0f5132; }
  .off  { background:#ffeef0; color:#c0262e; }

  nav {
    position:fixed; bottom:0; left:0; right:0;
    background:#ffffff;
    border-top:1px solid #e5e7eb;
    display:flex; justify-content:space-around;
    padding:10px 0;
    font-size:15px;
  }
  nav a { text-decoration:none; color:#0f172a; font-weight:600; }
  nav a.active { color:#1d4ed8; }

  @media (prefers-color-scheme:dark) {
    body { background:#0b1220; color:#e6eef8; }
    .card { background:#071226; }
    nav { background:#0b1220; border-top-color:#1e2633; }
    nav a { color:#e6eef8; }
    nav a.active { color:#60a5fa; }
    .forecast-item.work { background:#0a2f1f; color:#8ff4c8; }
    .forecast-item.off  { background:#3f0a0a; color:#ffb4b4; }
  }

  /* Modal */
  #modalOverlay {
    position:fixed; top:0; left:0; right:0; bottom:0;
    background:rgba(0,0,0,0.4);
    display:none; justify-content:center; align-items:center;
    z-index:1000;
  }
  #modalBox {
    background:white;
    padding:20px;
    border-radius:14px;
    width:80%;
    max-width:300px;
    text-align:center;
    box-shadow:0 6px 18px rgba(0,0,0,0.2);
  }

  /* Party poppers */
  .confetti {
    position: fixed;
    width: 10px;
    height: 10px;
    background: red;
    top: -20px;
    animation: confettiFall 3s linear forwards;
    border-radius: 2px;
    z-index: 2000;
  }
  @keyframes confettiFall {
    to { transform: translateY(120vh) rotate(720deg); opacity:0; }
  }

  .balloon {
    position: fixed;
    width: 40px;
    height: 50px;
    background: pink;
    border-radius: 50%;
    bottom: -60px;
    animation: balloonRise 3s ease-out forwards;
    z-index: 2000;
  }
  @keyframes balloonRise {
    to { transform: translateY(-120vh); opacity:0; }
  }
</style>
</head>

<body>

<div id="slide" class="slide-in-left">

  <div class="card">
    <h1>Is Simon off?</h1>

    <div id="todayStatus"></div>
    <div id="tomorrowStatus" style="margin-top:8px;"></div>

    <hr style="margin:20px 0;">

    <h2>14-Day Work Forecast (Simon)</h2>
    <div id="forecastList"></div>

    <h2 style="margin-top:25px;">Next Day Simon Works</h2>
    <div id="nextWork"></div>

    <hr style="margin:20px 0;">

    <h2>Select a date</h2>
    <input type="date" id="datePick" style="padding:8px; font-size:16px; width:100%; max-width:300px;">
    <button id="checkBtn" style="margin-top:10px; padding:10px 16px;">Check</button>

    <hr style="margin:20px 0;">

    <p><a href="https://monzo.me/matthewsanders48/1.00?d=Pwa&h=WmeOsl">give me money thanks</a></p>
  </div>

</div>

<!-- Modal -->
<div id="modalOverlay">
  <div id="modalBox">
    <div id="modalText"></div>
    <br>
    <button onclick="closeModal()" style="padding:8px 16px;">Close</button>
  </div>
</div>

<nav>
  <a href="test.html" data-direction="right">Frost</a>
  <a href="index.html" class="active" data-direction="left">Is simon off?</a>
</nav>

<script>
document.querySelectorAll("nav a").forEach(link => {
  link.addEventListener("click", e => {
    e.preventDefault();
    const dir = link.dataset.direction;
    const slide = document.getElementById("slide");
    slide.className = dir === "left" ? "slide-in-left" : "slide-in-right";
    setTimeout(() => window.location.href = link.href, 200);
  });
});
</script>

<script>
/* ===============================================================
   SIMON'S TRUE 6-WEEK (42-DAY) ROTATION
   =============================================================== */

const rotaBase = new Date("2025-11-30");

/* OFF DAYS WITHIN THE 42-DAY CYCLE */
const offOffsets = new Set([
  0,1,2,        // Sun–Tue
  8,9,          // Mon–Tue
  15,           // Mon
  20,21,        // Sat–Sun
  26,27,28,     // Fri–Sun
  33,34,35,     // Thu–Sat
  41            // Sat
]);

function isSimonOffOn(date){
  const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
  const diff = Math.floor((d - rotaBase) / 86400000);
  return diff >= 0 && offOffsets.has(diff % 42);
}

function formatStatus(isOff){
  return isOff
    ? `<div class="status-bad">Simon is OFF</div>`
    : `<div class="status-good">Simon is working</div>`;
}

function formatDate(d){
  return d.toLocaleDateString("en-GB", {
    weekday:"short", day:"2-digit", month:"short"
  });
}

/* Today + Tomorrow */
const today = new Date();
const tomorrow = new Date();
tomorrow.setDate(today.getDate() + 1);

document.getElementById("todayStatus").innerHTML =
  `<strong>Today:</strong><br>${formatStatus(isSimonOffOn(today))}`;
document.getElementById("tomorrowStatus").innerHTML =
  `<strong>Tomorrow:</strong><br>${formatStatus(isSimonOffOn(tomorrow))}`;

/* 14-day forecast */
(function(){
  const list = document.getElementById("forecastList");
  for (let i=0;i<14;i++){
    const d = new Date();
    d.setDate(today.getDate() + i);
    const isOff = isSimonOffOn(d);
    const row = document.createElement("div");
    row.className = "forecast-item " + (isOff ? "off" : "work");
    row.textContent = `${formatDate(d)} — ${isOff ? "OFF" : "Working"}`;
    list.appendChild(row);
  }
})();

/* Next working day */
(function(){
  const el = document.getElementById("nextWork");
  for (let i=1;i<200;i++){
    const d = new Date();
    d.setDate(today.getDate() + i);
    if (!isSimonOffOn(d)){
      el.textContent = `${formatDate(d)} — Simon is working`;
      return;
    }
  }
  el.textContent = "Unable to determine next working day.";
})();
</script>

<script>
/* ===============================================================
   DATE PICKER + POPUP + PARTY
   =============================================================== */

const modal = document.getElementById("modalOverlay");
const modalText = document.getElementById("modalText");

function closeModal(){ modal.style.display="none"; }

document.getElementById("checkBtn").onclick = () => {
  const val = document.getElementById("datePick").value;
  if(!val) return;

  const d = new Date(val);
  const isOff = isSimonOffOn(d);

  modalText.innerHTML =
    `${formatDate(d)}<br><br>` +
    (isOff
      ? `<span class="status-bad">Simon is OFF!</span>`
      : `<span class="status-good">Simon is working</span>`
    );

  modal.style.display="flex";

  if(isOff){
    launchParty();
  }
};

function launchParty(){
  for(let i=0;i<40;i++){
    const conf = document.createElement("div");
    conf.className="confetti";
    conf.style.left = Math.random()*100+"vw";
    conf.style.background = `hsl(${Math.random()*360},80%,60%)`;
    document.body.appendChild(conf);
    setTimeout(()=>conf.remove(),3000);
  }

  for(let i=0;i<6;i++){
    const bal = document.createElement("div");
    bal.className="balloon";
    bal.style.left = Math.random()*100+"vw";
    bal.style.background = `hsl(${Math.random()*360},70%,70%)`;
    document.body.appendChild(bal);
    setTimeout(()=>bal.remove(),3000);
  }
}
</script>

  <script>
// Add to Home Screen
let deferredPrompt;
const addHomeBtn=document.getElementById('addHome');
window.addEventListener('beforeinstallprompt',e=>{
  e.preventDefault(); deferredPrompt=e;
  addHomeBtn.style.display='inline-block';
});
addHomeBtn.addEventListener('click',async()=>{
  addHomeBtn.style.display='none';
  if(deferredPrompt){ deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; }
});
</script>

<script>
// Service worker
if("serviceWorker" in navigator){
  window.addEventListener("load",()=>navigator.serviceWorker.register("sw.js"));
}
</script>

</body>
</html>
